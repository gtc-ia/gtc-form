
<!-- GTC Unified Access Form (Registration/Login) -->
<form method="POST" action="https://kfilipenko.app.n8n.cloud/webhook/user-access" target="_blank" onsubmit="return handleFormSubmit(event)" style="
  max-width: 420px;
  margin: auto;
  padding: 2rem;
  background: #1a1a1a;
  border-radius: 12px;
  font-family: 'Segoe UI', sans-serif;
  color: #fff;
  box-shadow: 0 0 24px rgba(0,0,0,0.3);
">
  <h2 style="text-align:center;margin-bottom:1rem">Добро пожаловать в GTC</h2>

  <label for="mode">Выберите действие:</label>
  <select name="mode" id="mode" required>
    <option value="login">Вход</option>
    <option value="register">Регистрация</option>
  </select>

  <label for="email">Email</label>
  <input type="email" id="email" name="email" required>

  <label for="name">Имя (только при регистрации)</label>
  <input type="text" id="name" name="name">

  <label for="password">Пароль</label>
  <input type="password" id="password" name="password" required>

  <label for="source">Источник</label>
  <select name="source" id="source" required>
    <option value="telegram">Telegram</option>
    <option value="web">Web-сайт</option>
    <option value="github">GitHub Pages</option>
    <option value="wix">Wix</option>
    <option value="tilda">Tilda</option>
    <option value="other">Другое</option>
  </select>

  <label for="prompt">Ваш вопрос или запрос</label>
  <textarea id="prompt" name="prompt" rows="4" required></textarea>

  <input type="hidden" name="executionMode" value="user-form" />

  <button type="submit">Продолжить</button>

  <p id="confirmation" style="display:none;color:#8bc34a;text-align:center;">✅ Запрос отправлен! Спасибо.</p>
</form>

<script>
function handleFormSubmit(event) {
  const form = event.target;
  const passwordInput = form.querySelector('#password');
  const password = passwordInput.value;
  const hashed = btoa(unescape(encodeURIComponent(password)));
  const hiddenInput = document.createElement('input');
  hiddenInput.type = 'hidden';
  hiddenInput.name = 'password';
  hiddenInput.value = hashed;
  form.appendChild(hiddenInput);
  passwordInput.disabled = true;
  setTimeout(() => {
    form.style.display = 'none';
    document.getElementById('confirmation').style.display = 'block';
  }, 200);
  return true;
}
</script>
